<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nguyen Bao Thu Phuong">
<meta name="dcterms.date" content="2024-11-08">

<title>ISSS626-GAA - Take-home Exercise 3: Preparing HDB data for Geographically Weighted Predictive Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">



<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS626-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex011.html">
 <span class="dropdown-text">1.1 - Geospatial Data Wrangling with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex012.html">
 <span class="dropdown-text">1.2 - Choropleth Mapping with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex021.html">
 <span class="dropdown-text">2.1 - 1st Order Spatial Point Patterns Analysis Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex022.html">
 <span class="dropdown-text">2.2 - 2nd Order Spatial Point Patterns Analysis Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex031.html">
 <span class="dropdown-text">3.1 - Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex041.html">
 <span class="dropdown-text">4.1 - Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex051.html">
 <span class="dropdown-text">5.1 - Global Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex052.html">
 <span class="dropdown-text">5.2 - Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex061.html">
 <span class="dropdown-text">6.1 - Geographical Segmentation with Spatially Constrained Clustering Techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html">
 <span class="dropdown-text">7.1 - Calibrate Hedonic Pricing Model for Private Highrise Property</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html">
 <span class="dropdown-text">8.1 - Geographically Weighted Predictive Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html">
 <span class="dropdown-text">9.1 - Modelling Geographical Accessibility</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex101.html">
 <span class="dropdown-text">10.1 - Process and Visualize Flow Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex102.html">
 <span class="dropdown-text">10.2 - Calibrate Spatial Interaction Models with R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex01/In-class_Ex01.html">
 <span class="dropdown-text">1 - Geospatial Data Analysis with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html">
 <span class="dropdown-text">2 - Spatial Point Pattern Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html">
 <span class="dropdown-text">3 - Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html">
 <span class="dropdown-text">4 - Geographically Weighted Summary Statistics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html">
 <span class="dropdown-text">5 - Global and Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html">
 <span class="dropdown-text">6 - Emerging Hot Spot Analysis (EHSA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html">
 <span class="dropdown-text">7 - Calibrate Hedonic Pricing Model for Private Highrise Property</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex08/In-class_Ex08.html">
 <span class="dropdown-text">8 - Geographically Weighted Predictive Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html">
 <span class="dropdown-text">9 - Modelling Geographic of Accessibility</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html">
 <span class="dropdown-text">1 - Geospatial Analytics for Public Good</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html">
 <span class="dropdown-text">2 - Discover impacts of COVID-19 on Thailand tourism economy using spatial and spatio-temporal statistics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html">
 <span class="dropdown-text">3 - Predict HDB Resale Prices with Geographically Weighted Machine Learning Methods</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/nguyenbaothuphuong/"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="fa6-brands:linkedin" style="font-size: 2em;" aria-label="Icon linkedin from fa6-brands Iconify.design set." title="Icon linkedin from fa6-brands Iconify.design set."></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#setting-the-scene" id="toc-setting-the-scene" class="nav-link" data-scroll-target="#setting-the-scene"><span class="header-section-number">1.1</span> Setting the Scene</a></li>
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective"><span class="header-section-number">1.2</span> Objective</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data"><span class="header-section-number">1.3</span> The Data</a></li>
  </ul></li>
  <li><a href="#import-r-packages" id="toc-import-r-packages" class="nav-link" data-scroll-target="#import-r-packages"><span class="header-section-number">2</span> Import R Packages</a></li>
  <li><a href="#import-geospatial-and-aspatial-data" id="toc-import-geospatial-and-aspatial-data" class="nav-link" data-scroll-target="#import-geospatial-and-aspatial-data"><span class="header-section-number">3</span> Import Geospatial and Aspatial Data</a>
  <ul class="collapse">
  <li><a href="#import-aspatial-data" id="toc-import-aspatial-data" class="nav-link" data-scroll-target="#import-aspatial-data"><span class="header-section-number">3.1</span> Import Aspatial Data</a>
  <ul class="collapse">
  <li><a href="#hdb-resale-transactions" id="toc-hdb-resale-transactions" class="nav-link" data-scroll-target="#hdb-resale-transactions"><span class="header-section-number">3.1.1</span> HDB Resale Transactions</a></li>
  </ul></li>
  <li><a href="#import-geospatial-data" id="toc-import-geospatial-data" class="nav-link" data-scroll-target="#import-geospatial-data"><span class="header-section-number">3.2</span> Import Geospatial Data</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><span class="header-section-number">4</span> Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#flat-models-dummy-columns" id="toc-flat-models-dummy-columns" class="nav-link" data-scroll-target="#flat-models-dummy-columns"><span class="header-section-number">4.1</span> Flat Models Dummy Columns</a></li>
  <li><a href="#proximity-to-amenities" id="toc-proximity-to-amenities" class="nav-link" data-scroll-target="#proximity-to-amenities"><span class="header-section-number">4.2</span> Proximity to Amenities</a></li>
  <li><a href="#number-of-amenities-within-close-distance" id="toc-number-of-amenities-within-close-distance" class="nav-link" data-scroll-target="#number-of-amenities-within-close-distance"><span class="header-section-number">4.3</span> Number of amenities within close distance</a>
  <ul class="collapse">
  <li><a href="#distance-350m" id="toc-distance-350m" class="nav-link" data-scroll-target="#distance-350m"><span class="header-section-number">4.3.1</span> Distance 350m</a></li>
  <li><a href="#distance-1km" id="toc-distance-1km" class="nav-link" data-scroll-target="#distance-1km"><span class="header-section-number">4.3.2</span> Distance 1km</a></li>
  </ul></li>
  <li><a href="#merge-to-final-data-frame" id="toc-merge-to-final-data-frame" class="nav-link" data-scroll-target="#merge-to-final-data-frame"><span class="header-section-number">4.4</span> Merge to final data frame</a></li>
  </ul></li>
  <li><a href="#compute-correlation-matrix" id="toc-compute-correlation-matrix" class="nav-link" data-scroll-target="#compute-correlation-matrix"><span class="header-section-number">5</span> Compute Correlation Matrix</a></li>
  <li><a href="#derive-train-and-test-dataset." id="toc-derive-train-and-test-dataset." class="nav-link" data-scroll-target="#derive-train-and-test-dataset."><span class="header-section-number">6</span> Derive train and test dataset.</a>
  <ul class="collapse">
  <li><a href="#check-for-overlapping-points" id="toc-check-for-overlapping-points" class="nav-link" data-scroll-target="#check-for-overlapping-points"><span class="header-section-number">6.1</span> Check for Overlapping Points</a></li>
  </ul></li>
  <li><a href="#non-spatial-multiple-linear-regression" id="toc-non-spatial-multiple-linear-regression" class="nav-link" data-scroll-target="#non-spatial-multiple-linear-regression"><span class="header-section-number">7</span> Non-spatial Multiple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#multicollinearity-check-with-vif" id="toc-multicollinearity-check-with-vif" class="nav-link" data-scroll-target="#multicollinearity-check-with-vif"><span class="header-section-number">7.1</span> Multicollinearity check with VIF</a></li>
  <li><a href="#calibrate-final-model" id="toc-calibrate-final-model" class="nav-link" data-scroll-target="#calibrate-final-model"><span class="header-section-number">7.2</span> Calibrate final model</a></li>
  </ul></li>
  <li><a href="#non-spatial-random-forest" id="toc-non-spatial-random-forest" class="nav-link" data-scroll-target="#non-spatial-random-forest"><span class="header-section-number">8</span> Non-spatial Random Forest</a>
  <ul class="collapse">
  <li><a href="#prepare-coordinates-data" id="toc-prepare-coordinates-data" class="nav-link" data-scroll-target="#prepare-coordinates-data"><span class="header-section-number">8.1</span> Prepare Coordinates data</a></li>
  <li><a href="#calibrate-random-forest-model" id="toc-calibrate-random-forest-model" class="nav-link" data-scroll-target="#calibrate-random-forest-model"><span class="header-section-number">8.2</span> Calibrate Random Forest Model</a></li>
  </ul></li>
  <li><a href="#geographically-weighted-random-forest-gwrf" id="toc-geographically-weighted-random-forest-gwrf" class="nav-link" data-scroll-target="#geographically-weighted-random-forest-gwrf"><span class="header-section-number">9</span> Geographically Weighted Random Forest (GWRF)</a>
  <ul class="collapse">
  <li><a href="#predict-using-test-data" id="toc-predict-using-test-data" class="nav-link" data-scroll-target="#predict-using-test-data"><span class="header-section-number">9.1</span> Predict using test data</a>
  <ul class="collapse">
  <li><a href="#convert-the-predicting-output-into-a-data-frame" id="toc-convert-the-predicting-output-into-a-data-frame" class="nav-link" data-scroll-target="#convert-the-predicting-output-into-a-data-frame"><span class="header-section-number">9.1.1</span> Convert the predicting output into a data frame</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#compare-model-performance" id="toc-compare-model-performance" class="nav-link" data-scroll-target="#compare-model-performance"><span class="header-section-number">10</span> Compare Model Performance</a>
  <ul class="collapse">
  <li><a href="#rmse-and-mae" id="toc-rmse-and-mae" class="nav-link" data-scroll-target="#rmse-and-mae"><span class="header-section-number">10.1</span> RMSE and MAE</a></li>
  <li><a href="#visualize-the-predicted-values" id="toc-visualize-the-predicted-values" class="nav-link" data-scroll-target="#visualize-the-predicted-values"><span class="header-section-number">10.2</span> Visualize the Predicted Values</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">11</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 3: Preparing HDB data for Geographically Weighted Predictive Model</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nguyen Bao Thu Phuong </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 8, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 9, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<section id="setting-the-scene" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="setting-the-scene"><span class="header-section-number">1.1</span> Setting the Scene</h2>
<p>Housing is a crucial part of household wealth globally and often represents a major investment. Housing prices are influenced by global factors, like a country’s economy and inflation, as well as property-specific factors that can be divided into structural and locational categories. Structural factors relate to the property itself, such as size, fittings, and tenure, while locational factors pertain to neighborhood characteristics like proximity to childcare centers, public transportation, and shopping centers.</p>
<p>Traditionally, predictive models for housing resale prices have used the Ordinary Least Square (OLS) method. However, this approach does not account for spatial autocorrelation and spatial heterogeneity present in geographic datasets like housing transactions, potentially leading to biased or inefficient predictions (Anselin 1998). To address these limitations, Geographically Weighted Models (GWM) were introduced, offering more accurate calibrations for housing price predictions.</p>
</section>
<section id="objective" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="objective"><span class="header-section-number">1.2</span> Objective</h2>
<p>This study will calibrate both non-spatial and spatially weighted predictive models to forecast Singapore HDB resale prices for July-September 2024, using 2023 HDB resale transaction records. We will compare the derived models and their performances to understand the differences between conventional and spatially weighted predictive models.</p>
</section>
<section id="the-data" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="the-data"><span class="header-section-number">1.3</span> The Data</h2>
<p>For this study, the HDB Resale Flat Prices dataset from <a href="https://data.gov.sg/datasets/d_8b84c4ee58e3cfc0ece0d773c8ca6abc/view">Data.gov.sg</a> will be used as the core dataset.</p>
<p>The below datasets are also included to derive the recommended predictors for calibrating the models:</p>
<ul>
<li><p>MRT (Train Station Exit Point shapefile, updated June 2024), Bus Stop (updated July 2024): <a href="https://datamall.lta.gov.sg/content/datamall/en.html">LTA DataMall</a></p></li>
<li><p>Eldercare, Hawker Centres, Parks, Supermarkets, CHAS Clinics, Childcare Services, Kindergartens: Geojson/shapefile data from <a href="https://data.gov.sg/">Data.gov.sg</a>.</p></li>
<li><p>Shopping mall: list from <a href="https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore">Wikipedia</a></p></li>
<li><p>Primary school: csv list from <a href="https://data.gov.sg/">Data.gov.sg</a> (General information of schools dataset)</p></li>
<li><p>Top school by popularity in 2024: as of <a href="https://www.salary.sg/2024/best-primary-schools-2024-by-popularity/">Local salary forum</a></p></li>
</ul>
<p>The recommended predictors include both structural and location related factors:</p>
<ul>
<li><p>Structural factors</p>
<ul>
<li><p>Area of the unit</p></li>
<li><p>Floor level</p></li>
<li><p>Remaining lease</p></li>
<li><p>Age of the unit</p></li>
<li><p>Flat model</p></li>
</ul></li>
<li><p>Locational factors</p>
<ul>
<li><p>Proxomity to CBD</p></li>
<li><p>Proximity to eldercare</p></li>
<li><p>Proximity to foodcourt/hawker centres</p></li>
<li><p>Proximity to MRT</p></li>
<li><p>Proximity to park</p></li>
<li><p>Proximity to good primary school</p></li>
<li><p>Proximity to shopping mall</p></li>
<li><p>Proximity to supermarket</p></li>
<li><p>Numbers of kindergartens within 350m</p></li>
<li><p>Numbers of childcare centres within 350m</p></li>
<li><p>Numbers of bus stop within 350m</p></li>
<li><p>Numbers of primary school within 1km</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="import-r-packages" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Import R Packages</h1>
<p>The below code chunk uses <code>p_load()</code> of pacman package to install and load relevant packages into R environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rvest,jsonlite ,sf, SpatialML, tmap, Metrics, tidyverse, ggplot2, olsrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p><strong>rvest</strong>: use for web crawling</p></li>
<li><p><strong>jsonlite</strong>: to convert json file to dataframe format</p></li>
<li><p><strong>sf</strong>: Simplifies handling and analysis of spatial vector data using simple features.</p></li>
<li><p><strong>SpatialML</strong>: Integrates spatial machine learning for predictive modeling with spatial data.</p></li>
<li><p><strong>tmap</strong>: Creates thematic maps for spatial data with interactive and static plotting.</p></li>
<li><p><strong>Metrics</strong>: Offers a suite of standard performance metrics for evaluating predictive models.</p></li>
<li><p><strong>tidyverse</strong>: A collection of packages for data manipulation, exploration, and visualization.</p></li>
<li><p><strong>ggplot2</strong>: Provides a flexible, grammar-based approach to create complex visualizations.</p></li>
<li><p><strong>olsrr</strong>: Provide tools for OLS regression.</p></li>
</ul>
</section>
<section id="import-geospatial-and-aspatial-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Import Geospatial and Aspatial Data</h1>
<section id="import-aspatial-data" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="import-aspatial-data"><span class="header-section-number">3.1</span> Import Aspatial Data</h2>
<section id="hdb-resale-transactions" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="hdb-resale-transactions"><span class="header-section-number">3.1.1</span> HDB Resale Transactions</h3>
<p>First we load in the Resale transactions from January 2023 to December 2023 and from July 2024 to September 2024 in <code>resale.csv</code> into R environment using the below functions:</p>
<ul>
<li><p><code>read_csv()</code>: to read in csv file</p></li>
<li><p><code>filter()</code>: to filter for the relevant months</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>resale_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/rawdata/resale.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2023-01"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2023-12"</span> <span class="sc">|</span> month <span class="sc">&gt;=</span> <span class="st">"2024-07"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2024-09"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 192234 Columns: 11
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (8): month, town, flat_type, block, street_name, storey_range, flat_mode...
dbl (3): floor_area_sqm, lease_commence_date, resale_price

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>As flats with different number of rooms tend to have very different price range, we plot multiple box plots to visualize the price range of different room types using <code>ggplot</code> functions as in the below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create box plot of resale_price by flat_type</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resale_raw, <span class="fu">aes</span>(<span class="at">x =</span> flat_type, <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Box Plot of Resale Prices by Flat Type"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Flat Type"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Resale Price"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The box plots show that resale price range increase with flat size. The price range is especially wider for flat type with 3 ROOM, 4 ROOM and 5 ROOM, with 3 ROOM having the widest range.</p>
<p>Next we plot the number of transactions for each flat type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a column chart for the number of transactions by flat_type</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resale_raw, <span class="fu">aes</span>(<span class="at">x =</span> flat_type)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Transactions by Flat Type"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Flat Type"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Transactions"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The column chart indicates that 4-room flats had the highest transaction volume during the selected period, nearing 15,000 transactions, while both 3-room and 5-room flats recorded over 7,500 transactions each. Given that each flat type has a distinct price range, this study will focus on 3-room flats due to their higher price variability. This variability poses a challenge for prediction, offering a way to distinguish model performance. This flat type also has sufficient number of records to calibrate predictive models.</p>
<p>The below code create additional attributes and filter for <code>flat_type = 3 ROOM</code> using the below functions. The output is saved in <code>resale_tidy</code> tibble dataframe.</p>
<ul>
<li><p><code>filter()</code>: filter for flat_type == 3 ROOM</p></li>
<li><p><code>mutate()</code>: create new columns on:</p>
<ul>
<li><p><code>address</code>: using paste() to concatenate block and street name</p></li>
<li><p><code>remaining_lease_yr</code>: extract the number of years as integer from remaining_lease column</p></li>
<li><p><code>remaining_lease_mth</code>: extract the number of months as integer from remaining_lease column. Return 0 if the number of months is not provided.</p></li>
<li><p><code>remaining_lease_yrs</code>: total remaining lease in years (= remaining_lease_yr + remaining_lease_mth/12)</p></li>
<li><p><code>storey_order</code>: extract the first number from storey_range</p></li>
<li><p><code>unit_age</code>: = current year - lease commencement date</p></li>
</ul></li>
<li><p><code>select()</code>: to select relevant columns</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>current_year <span class="ot">=</span> <span class="dv">2024</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>resale_tidy <span class="ot">&lt;-</span> resale_raw <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"3 ROOM"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">address =</span> <span class="fu">paste</span>(block,street_name)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">remaining_lease_yr =</span> <span class="fu">as.integer</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(remaining_lease, <span class="dv">0</span>, <span class="dv">2</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">remaining_lease_mth =</span> <span class="fu">if_else</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(<span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">9</span>, <span class="dv">11</span>))),<span class="dv">0</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">9</span>, <span class="dv">11</span>)) <span class="co"># to handle cases where there are no month value</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">remaining_lease_yrs =</span> remaining_lease_yr <span class="sc">+</span> remaining_lease_mth<span class="sc">/</span><span class="dv">12</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">storey_order =</span> <span class="fu">as.integer</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(storey_range, <span class="dv">0</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unit_age =</span> <span class="dv">2024</span> <span class="sc">-</span> lease_commence_date ) <span class="sc">|&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"address"</span>,<span class="st">"month"</span>,<span class="st">"flat_model"</span>,<span class="st">"floor_area_sqm"</span>,<span class="st">"resale_price"</span>,<span class="st">"remaining_lease_yrs"</span>,<span class="st">"storey_order"</span>,<span class="st">"unit_age"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we use summary() of base R to have an overview of <code>resale_tidy</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resale_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   address             month            flat_model        floor_area_sqm  
 Length:8264        Length:8264        Length:8264        Min.   : 52.00  
 Class :character   Class :character   Class :character   1st Qu.: 66.00  
 Mode  :character   Mode  :character   Mode  :character   Median : 67.00  
                                                          Mean   : 68.13  
                                                          3rd Qu.: 69.00  
                                                          Max.   :366.70  
  resale_price     remaining_lease_yrs  storey_order       unit_age    
 Min.   : 150000   Min.   :41.42       Min.   : 1.000   Min.   : 4.00  
 1st Qu.: 362000   1st Qu.:53.50       1st Qu.: 4.000   1st Qu.:13.00  
 Median : 400000   Median :59.58       Median : 7.000   Median :40.00  
 Mean   : 419939   Mean   :65.14       Mean   : 7.078   Mean   :34.64  
 3rd Qu.: 450000   3rd Qu.:86.44       3rd Qu.:10.000   3rd Qu.:46.00  
 Max.   :1568000   Max.   :95.50       Max.   :40.000   Max.   :58.00  </code></pre>
</div>
</div>
<p>The output shows this dataframe contains 8264 records, with no column having records with NA values. NA values can cause issue when running predictive modelling later. We proceed with this dataset for further analysis.</p>
<p>Next we extract the list of unique addresses from <code>resale_tidy</code> to scrape for the respective coordinates from OneMap API. The list is sorted to ensure the first address is always picked up and hence the scraping process is optimal. The output is saved in <code>add_list</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>add_list <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_tidy<span class="sc">$</span>address))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below <code>get_coords</code> function reads in any address list and return the respective postal code, longitude and latitude in a dataframe.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>get_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(add_list){</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame to store all retrieved coordinates</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  postal_coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> add_list){</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(i)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># as the API provided code for 1 address search at a time only, for pasrsing a list of addresses we use the common/elastic/search syntax as below</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">'https://www.onemap.gov.sg/api/common/elastic/search?'</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">query=</span><span class="fu">list</span>(<span class="at">searchVal=</span>i,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">returnGeom=</span><span class="st">'Y'</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">getAddrDetails=</span><span class="st">'Y'</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(r<span class="sc">$</span>content))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    found <span class="ot">&lt;-</span> data<span class="sc">$</span>found</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> data<span class="sc">$</span>results</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new data frame for each address</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If single result, append </span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (found <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      postal <span class="ot">&lt;-</span> res<span class="sc">$</span>POSTAL </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> res<span class="sc">$</span>LATITUDE</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>      lng <span class="ot">&lt;-</span> res<span class="sc">$</span>LONGITUDE</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> postal, </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> lat, </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> lng)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If multiple results, drop NIL and append top 1</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (found <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove those with NIL as postal</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>      res_sub <span class="ot">&lt;-</span> res[res<span class="sc">$</span>POSTAL <span class="sc">!=</span> <span class="st">"NIL"</span>, ]</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set as NA first if no Postal</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(res_sub) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>          new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                                <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                                <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        top1 <span class="ot">&lt;-</span> <span class="fu">head</span>(res_sub, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        postal <span class="ot">&lt;-</span> top1<span class="sc">$</span>POSTAL </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        lat <span class="ot">&lt;-</span> top1<span class="sc">$</span>LATITUDE</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        lng <span class="ot">&lt;-</span> top1<span class="sc">$</span>LONGITUDE</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                              <span class="at">postal =</span> postal, </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>                              <span class="at">latitude =</span> lat, </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>                              <span class="at">longitude =</span> lng)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the row</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    postal_coords <span class="ot">&lt;-</span> <span class="fu">rbind</span>(postal_coords, new_row)</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(postal_coords)</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We run the <code>get_coords()</code> function on <code>add_list</code> to retrieve the addresses’ coordinates from OneMap API. The result is saved in <code>coords</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(add_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We write the result coordinates to rds file format using below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(coords, <span class="st">"data/rds/coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk read the HDB block coordinates from rds file into <code>block_coords</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>block_coords <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we convert <code>resale_tidy</code> into an <strong>sf</strong> dataframe <code>resale</code> using the below functions:</p>
<ul>
<li><p><code>left_join()</code>: join <code>resale_tidy</code> tibble data frame with <code>block_coords</code> on the <code>address</code> column</p></li>
<li><p><code>st_as_sf()</code>: convert into an <strong>sf</strong> dataframe using CRS <em>4326</em> as the obtained longitude and latitude is in WGS84 coordinates system.</p></li>
<li><p><code>st_transform()</code>: reproject the coordinates to Singapore projected CRS SVY21</p></li>
<li><p><code>select()</code>: exclude column <code>postal</code> since it is not needed in the remaining steps.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> resale_tidy <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(block_coords, <span class="at">by =</span> <span class="st">"address"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"postal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below converts <code>block_coords</code> to an sf data frame called <code>hdb_coords</code> to derive other geospatial attributes of HDB block (proximity to other amenities, number of amenities within close distance to the block). The below functions are used:</p>
<ul>
<li><p><code>st_as_sf()</code>: convert into an <strong>sf</strong> dataframe using CRS <em>4326</em> as the obtained longitude and latitude is in WGS84 coordinates system.</p></li>
<li><p><code>st_transform()</code>: reproject the coordinates to Singapore projected CRS SVY21</p></li>
<li><p><code>select()</code>: exclude column <code>postal</code> since it is not needed in the remaining steps.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hdb_coords <span class="ot">=</span> block_coords <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"postal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="import-geospatial-data" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="import-geospatial-data"><span class="header-section-number">3.2</span> Import Geospatial Data</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Singapore Master Plan Subzone Boundary</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Eldercare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">CHAS Clinic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Hawker</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Parks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">Supermarkets</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false">Childcare Services</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false">Kindergarten</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false">Bus Stops</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-10" role="tab" aria-controls="tabset-1-10" aria-selected="false">MRT Exit</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-11-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-11" role="tab" aria-controls="tabset-1-11" aria-selected="false">Shopping mall</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-12-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-12" role="tab" aria-controls="tabset-1-12" aria-selected="false">Primary School</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>The below code chunk imports Singapore Planning Subzone boundary to <code>mpsz</code> sf dataframe using the below functions:</p>
<ul>
<li><p><code>st_read()</code>: to read in shapefile</p></li>
<li><p><code>st_transform()</code>: to ensure the coordinates are transforms to the correct CRS <em>3414</em> of Singapore Projected Coordinate System SVY21.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/rawdata"</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">layer =</span> <span class="st">"MP14_SUBZONE_WEB_PL"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MP14_SUBZONE_WEB_PL' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata' 
  using driver `ESRI Shapefile'
Simple feature collection with 323 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33
Projected CRS: SVY21</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>The below code chunks read in the eldercare shapefile as downloaded from Data.gov.sg using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>eldercare <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'data/rawdata'</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">layer =</span> <span class="st">'ELDERCARE'</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `ELDERCARE' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata' 
  using driver `ESRI Shapefile'
Simple feature collection with 133 features and 18 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 14481.92 ymin: 28218.43 xmax: 41665.14 ymax: 46804.9
Projected CRS: SVY21</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>The below code chunks read in the CHAS clinics shapefile as downloaded from Data.gov.sg using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21. As the POINT features are given in 3 dimension XYZ, we use <code>st_zm()</code> to drop dimension Z as it is not required in the remaining steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>CHAS <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/rawdata/CHASClinics.kml'</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_zm</span>(<span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MOH_CHAS_CLINICS' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata\CHASClinics.kml' 
  using driver `KML'
Simple feature collection with 1193 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.5818 ymin: 1.016264 xmax: 103.9903 ymax: 1.456037
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>The below code chunks read in the Hawker geojson file as downloaded from Data.gov.sg using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21. As the POINT features are given in 3 dimension XYZ, we use <code>st_zm()</code> to drop dimension Z as it is not required in the remaining steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hawker <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/rawdata/HawkerCentresGEOJSON.geojson'</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_zm</span>(<span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `HawkerCentresGEOJSON' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata\HawkerCentresGEOJSON.geojson' 
  using driver `GeoJSON'
Simple feature collection with 125 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6974 ymin: 1.272716 xmax: 103.9882 ymax: 1.449017
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>The below code chunks read in the Parks geojson file as downloaded from Data.gov.sg using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21. As the POINT features are given in 3 dimension XYZ, we use <code>st_zm()</code> to drop dimension Z as it is not required in the remaining steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>parks <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/rawdata/Parks.geojson'</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)<span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_zm</span>(<span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Parks' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata\Parks.geojson' 
  using driver `GeoJSON'
Simple feature collection with 430 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6929 ymin: 1.214491 xmax: 104.0538 ymax: 1.462094
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<p>The below code chunks read in the Supermarketss geojson file as downloaded from Data.gov.sg using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21. As the POINT features are given in 3 dimension XYZ, we use <code>st_zm()</code> to drop dimension Z as it is not required in the remaining steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>supermarkets <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/rawdata/SupermarketsGEOJSON.geojson'</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)<span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_zm</span>(<span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SupermarketsGEOJSON' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata\SupermarketsGEOJSON.geojson' 
  using driver `GeoJSON'
Simple feature collection with 526 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6258 ymin: 1.24715 xmax: 104.0036 ymax: 1.461526
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<p>The below code chunks read in the Childcare Services centres geojson file as downloaded from Data.gov.sg using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21. As the POINT features are given in 3 dimension XYZ, we use <code>st_zm()</code> to drop dimension Z as it is not required in the remaining steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>childcare <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/rawdata/ChildCareServices.geojson'</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)<span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_zm</span>(<span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `ChildCareServices' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata\ChildCareServices.geojson' 
  using driver `GeoJSON'
Simple feature collection with 1925 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<p>The below code chunks read in the Kindergarten geojson file as downloaded from Data.gov.sg using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21. As the POINT features are given in 3 dimension XYZ, we use <code>st_zm()</code> to drop dimension Z as it is not required in the remaining steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>kindergarten <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/rawdata/Kindergartens.geojson'</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)<span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_zm</span>(<span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Kindergartens' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata\Kindergartens.geojson' 
  using driver `GeoJSON'
Simple feature collection with 448 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6887 ymin: 1.247759 xmax: 103.9717 ymax: 1.455452
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<p>The below code chunks read in the Bus stop shapefile as downloaded from LTA DataMall using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>bus_stop <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'data/rawdata'</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">layer =</span> <span class="st">'BusStop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BusStop' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata' 
  using driver `ESRI Shapefile'
Simple feature collection with 5166 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3970.122 ymin: 26482.1 xmax: 48285.52 ymax: 52983.82
Projected CRS: SVY21</code></pre>
</div>
</div>
<p>We check for duplicated records using the below code chunk. The output shows this dataset does not contain any duplicated records.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>bus_duplicate <span class="ot">&lt;-</span> bus_stop <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>()<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>bus_duplicate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 3 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: SVY21 / Singapore TM
# A tibble: 0 × 4
# ℹ 4 variables: BUS_STOP_N &lt;chr&gt;, BUS_ROOF_N &lt;chr&gt;, LOC_DESC &lt;chr&gt;,
#   geometry &lt;GEOMETRY [m]&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-1-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-10-tab">
<p>The below code chunks read in the MRT Station Exit shapefile as downloaded from LTA DataMall using <code>st_read()</code>. After that <code>st_transform()</code> is used to reproject the coordinates to CRS <em>3414</em> of Singapore Projected CRS SVY21.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>MRT_exit <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'data/rawdata'</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">layer =</span> <span class="st">'Train_Station_Exit_Layer'</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Train_Station_Exit_Layer' from data source 
  `C:\thuphuong1110\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\rawdata' 
  using driver `ESRI Shapefile'
Simple feature collection with 593 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 6134.086 ymin: 27499.7 xmax: 45356.36 ymax: 47865.92
Projected CRS: SVY21</code></pre>
</div>
</div>
<p>We check for duplicated records using the below code chunk. The output shows this dataset does not contain any duplicated records.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>exit_duplicate <span class="ot">&lt;-</span> MRT_exit <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>()<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>exit_duplicate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 2 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: SVY21 / Singapore TM
# A tibble: 0 × 3
# ℹ 3 variables: stn_name &lt;chr&gt;, exit_code &lt;chr&gt;, geometry &lt;GEOMETRY [m]&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-1-11" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-11-tab">
<p>As shopping mall coordinates dataset is not readily available, first we took the shopping mall name list from Wikipedia and saved in <code>shopping_mall.csv</code>. The below code chunk use <code>read_csv()</code> to read this list into <code>shopping_mall</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>shopping_mall <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/rawdata/shopping_mall.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 174 Columns: 1
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): shopping_mall

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Next we create a list of unique shopping mall name using <code>unique()</code> function and save the output in <code>mall_list</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mall_list <span class="ot">=</span> <span class="fu">unique</span>(shopping_mall<span class="sc">$</span>shopping_mall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk uses the previously defined <code>get_coords()</code> function to retrieve the respective coordinates for the shopping malls in <code>mall_list</code> from OneMap API. The output is saved in <code>mall_coords_full</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mall_coords_full <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(mall_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below converts <code>mall_coords_full</code> from a tibble dataframe to an sf data frame called <code>mall_coords</code> to facilitate future distance calculation. The below functions are used:</p>
<ul>
<li><p><code>st_as_sf()</code>: convert into an <strong>sf</strong> dataframe using CRS <em>4326</em> as the obtained longitude and latitude is in WGS84 coordinates system.</p></li>
<li><p><code>st_transform()</code>: reproject the coordinates to Singapore projected CRS SVY21.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mall_coords <span class="ot">=</span> mall_coords_full <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk writes the result to rds file for future usage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mall_coords, <span class="st">"data/rds/mall_coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We read the output from rds file into <code>mall_coords</code> using below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mall_coords <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/mall_coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-12" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-12-tab">
<p>As primary school coordinates dataset is not readily available, first we read in the school information of all schools provided by MOE using <code>read_csv()</code> and perform the below steps. The output is save in <code>primary_school</code> dataframe.</p>
<ul>
<li><p><code>filter()</code>: filter for Primary school only</p></li>
<li><p><code>select()</code>: select relevant columns</p></li>
<li><p><code>toupper()</code>: upper case all school name for joining with the top schools list later on, as <code>left_join()</code> is case sensitive.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>primary_school <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/rawdata/school_information.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mainlevel_code <span class="sc">==</span> <span class="st">"PRIMARY"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"school_name"</span>,<span class="st">"address"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 338 Columns: 31
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (29): school_name, url_address, address, telephone_no, telephone_no_2, f...
dbl  (1): postal_code
lgl  (1): sixth_vp_name

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>primary_school<span class="sc">$</span>school_name <span class="ot">&lt;-</span> <span class="fu">toupper</span>(primary_school<span class="sc">$</span>school_name) <span class="co"># upper case all school name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk obtains a list of unique school address and save in <code>school_list</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>school_list <span class="ot">=</span> <span class="fu">unique</span>(primary_school<span class="sc">$</span>address)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We run the function <code>get_coords</code> again to scrape the coordinates from OneMap API for the school addresses in <code>school_list</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>school_coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(school_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below converts <code>school_coords</code> from a tibble dataframe to an sf data frame to facilitate future distance calculation. The below functions are used:</p>
<ul>
<li><p><code>st_as_sf()</code>: convert into an <strong>sf</strong> dataframe using CRS <em>4326</em> as the obtained longitude and latitude is in WGS84 coordinates system.</p></li>
<li><p><code>st_transform()</code>: reproject the coordinates to Singapore projected CRS SVY21.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>school_coords <span class="ot">=</span> school_coords <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk writes the result to rds file for future usage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(school_coords, <span class="st">"data/rds/school_coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We read the output from rds file into <code>school_coords</code> using the below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>school_coords <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/school_coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we left join <code>school_coords</code> with <code>primary_school</code> with <code>school_coords</code> on the left side to ensure the output is an <strong>sf</strong> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>primary_school <span class="ot">=</span> school_coords <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(primary_school, <span class="at">by =</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk reads in primary school subscription rate as obtained from Local Salary Forum using <code>read_csv()</code>, followed by <code>toupper()</code> to convert the school names to upper case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>school_rate <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/rawdata/school_rating.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"school_name"</span>,<span class="st">"school_rating"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 180 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): list, school_name
dbl (1): school_rating

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>school_rate<span class="sc">$</span>school_name <span class="ot">&lt;-</span> <span class="fu">toupper</span>(school_rate<span class="sc">$</span>school_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We define top schools as popular schools which are oversubscribed in 2024 (subscription rate &gt; 1). The below code chunk left join <code>primary_school</code> with <code>school_rate</code> and filter for top schools with subscription rate &gt; 1. The result is saved in <code>top_school</code> sf dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>top_school <span class="ot">=</span> primary_school <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(school_rate, <span class="at">by =</span> <span class="st">"school_name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(school_rating <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(top_school)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   address             postal          school_name        school_rating  
 Length:32          Length:32          Length:32          Min.   :1.010  
 Class :character   Class :character   Class :character   1st Qu.:1.177  
 Mode  :character   Mode  :character   Mode  :character   Median :1.415  
                                                          Mean   :1.429  
                                                          3rd Qu.:1.583  
                                                          Max.   :2.130  
          geometry 
 POINT        :32  
 epsg:3414    : 0  
 +proj=tmer...: 0  
                   
                   
                   </code></pre>
</div>
</div>
<p>The output returns 32 top schools by popularity, with min subscription rate of 1.01 and max subscription rate of 2.13.</p>
</div>
</div>
</div>
</section>
</section>
<section id="data-wrangling" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Data Wrangling</h1>
<section id="flat-models-dummy-columns" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="flat-models-dummy-columns"><span class="header-section-number">4.1</span> Flat Models Dummy Columns</h2>
<p>We plot the price range by each flat model using the below code chunks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create box plot of resale_price by flat_type</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resale, <span class="fu">aes</span>(<span class="at">x =</span> flat_model, <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Box Plot of Resale Prices by Flat Model"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Flat Model"</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Resale Price"</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The box plots show clear differences in the price range of different flat models:</p>
<ul>
<li><p><strong>Terrace Model</strong>: This model has the highest resale prices, with a significantly higher median and larger range than all other models. This suggests that Terrace units may be premium properties with unique characteristics.</p></li>
<li><p><strong>DBSS, Model A and Premium Apartment Models</strong>: these models also have relatively high resale prices, though their price ranges are narrower than Terrace, indicating more consistency in pricing for these models.</p></li>
<li><p><strong>Standard, Simplified, New Generation and Improved Models</strong>: These models have lower median resale prices and narrower ranges, which may imply they are more basic or standard options with less variability in resale price.</p></li>
</ul>
<p>Next we plot the number of transactions for each flat models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a column chart for the number of transactions by flat_model</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resale, <span class="fu">aes</span>(<span class="at">x =</span> flat_model)) <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Transactions by Flat Model"</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Flat Model"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Transactions"</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The column chart shows Improved, Model A and New Generation models have the highest number of transactions (account for 87.3% of total number of transactions).</p>
<p>The below code chunk uses <code>model.matrix()</code> function to create dummy columns for each flat model, then <code>select()</code> is used to exclude the original flat_model columns and flat_modelTerrace as it will have multicollinearity with the remaining dummy columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using model.matrix to create dummy variables</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> <span class="fu">cbind</span>(resale, <span class="fu">model.matrix</span>(<span class="sc">~</span> flat_model <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> resale))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude the original flat_model columns and flat_modelTerrace to avoid multicollinearity</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">=</span> resale <span class="sc">|&gt;</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"flat_model"</span>,<span class="st">"flat_modelTerrace"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="proximity-to-amenities" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="proximity-to-amenities"><span class="header-section-number">4.2</span> Proximity to Amenities</h2>
<p>Proximity to amenities can significantly impact HDB resale prices in Singapore. Flats located near amenities like MRT stations, schools, shopping centers, and healthcare facilities tend to command higher resale values due to enhanced convenience and lifestyle appeal.</p>
<p>After loading in the coordinates of all relevant amenities, in this section, we continue to calculate the distance of each HDB block to its nearest amenities.</p>
<p>To calculate the distance to CBD, first we create a simple feature geometry list column given CBD longitude and latitude as look up from Google using below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>cbd_coords <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="fl">103.851784</span>, <span class="fl">1.287953</span>)), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk calculates the proximity of each HDB block to its relevant amenities, including proximity to CBD, nearest Eldercare, MRT exit, CHAS clinic, Hawker, Shopping Mall, Park, Top School, Supermarkets. <code>select()</code> is used at the end to select for relevant columns only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance from each block to different amenities in kilometers</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>hdb_coords <span class="ot">&lt;-</span> hdb_coords <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_CBD =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, cbd_coords, <span class="at">by_element =</span> <span class="cn">FALSE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_eldercare =</span> <span class="fu">st_nearest_feature</span>(geometry, eldercare),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="at">PROX_ELDERCARE =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                                        eldercare[nearest_eldercare, ],</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_MRT_exit =</span> <span class="fu">st_nearest_feature</span>(geometry, MRT_exit),</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_MRT =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, MRT_exit[nearest_MRT_exit, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_clinic =</span> <span class="fu">st_nearest_feature</span>(geometry, CHAS),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_CLINIC =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, CHAS[nearest_clinic, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_hawker =</span> <span class="fu">st_nearest_feature</span>(geometry, hawker),</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_HAWKER =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, hawker[nearest_hawker, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_park =</span> <span class="fu">st_nearest_feature</span>(geometry, parks),</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_PARK =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, parks[nearest_park, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_top_school =</span> <span class="fu">st_nearest_feature</span>(geometry, top_school),</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_TOP_SCHOOL =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, top_school[nearest_top_school, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_mall =</span> <span class="fu">st_nearest_feature</span>(geometry, mall_coords),</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_MALL =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, mall_coords[nearest_mall, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="at">nearest_supermarket =</span> <span class="fu">st_nearest_feature</span>(geometry, supermarkets),</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">PROX_SUPERMARKETS =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, supermarkets[nearest_supermarket, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"address"</span>,<span class="st">"PROX_MRT"</span>,<span class="st">"PROX_CBD"</span>,<span class="st">"PROX_ELDERCARE"</span>,</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>           <span class="st">"PROX_CLINIC"</span>,<span class="st">"PROX_HAWKER"</span>,<span class="st">"PROX_PARK"</span>,<span class="st">"PROX_TOP_SCHOOL"</span>,</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>           <span class="st">"PROX_MALL"</span>,<span class="st">"PROX_SUPERMARKETS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="number-of-amenities-within-close-distance" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="number-of-amenities-within-close-distance"><span class="header-section-number">4.3</span> Number of amenities within close distance</h2>
<p>In this section, we count the number of important amenities that is within a defined distance to each HDB block.</p>
<section id="distance-350m" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="distance-350m"><span class="header-section-number">4.3.1</span> Distance 350m</h3>
<p>The below code chunks create a buffer of 350m around each HDB block using <code>st_buffer()</code>. The output is saved in <code>buffer_350m</code> sf dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>buffer_350m <span class="ot">=</span> <span class="fu">st_buffer</span>(hdb_coords, <span class="at">dist =</span> <span class="dv">350</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"address"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We plot the map using multiple <strong>tmap</strong> functions to see if the buffer area is properly created</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(buffer_350m) <span class="sc">+</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(eldercare) <span class="sc">+</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The shape mpsz is invalid. See sf::st_is_valid</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To count the number of points with in a buffer area, first <code>st_intersects()</code> is used to identify the amenities that lie within the buffer area, then <code>lengths()</code> is used to count the number of points.</p>
<p>The below code chunk counts the number of kindergarten, childcare and bus stops that are within 350m distance from each HDB block. The results are saved in columns <code>kindergarten_count</code>, <code>childcare_count</code> and <code>bus_stop_count</code> of <code>buffer_350m</code> sf dataframe respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>buffer_350m<span class="sc">$</span>kindergarten_count <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_350m, kindergarten))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>buffer_350m<span class="sc">$</span>childcare_count <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_350m, childcare))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>buffer_350m<span class="sc">$</span>bus_stop_count <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_350m, bus_stop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distance-1km" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="distance-1km"><span class="header-section-number">4.3.2</span> Distance 1km</h3>
<p>The below code chunks create a buffer of 1km around each HDB block using <code>st_buffer()</code>. The output is saved in <code>buffer_1km</code> sf dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>buffer_1km <span class="ot">=</span> <span class="fu">st_buffer</span>(hdb_coords, <span class="at">dist =</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"address"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar to the previous section, the below code chunk counts the number of primary schools that are within 1km distance from each HDB block. The results are saved in columns <code>pri_school_count</code> of <code>buffer_1km</code> sf dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>buffer_1km<span class="sc">$</span>pri_school_count <span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_1km, primary_school))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="merge-to-final-data-frame" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="merge-to-final-data-frame"><span class="header-section-number">4.4</span> Merge to final data frame</h2>
<p>In this part, we merge all the previously derived proximity to amenities and count of amenities within close distance to <code>resale</code> sf dataframe to calibrate predictive models.</p>
<p>First we need to drop geometry from <code>hdb_coords</code> sf dataframe to allow for joining with <code>resale</code> sf dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>hdb_coords_nogeo <span class="ot">=</span> <span class="fu">st_drop_geometry</span>(hdb_coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk join <code>resale</code> with <code>hdb_coords_nogeo</code> to bring in proximity to amenities for each transaction using <code>left_join()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> resale <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hdb_coords_nogeo, <span class="at">by =</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, we need to drop geometry from <code>buffer_350m</code> sf dataframe to allow for joining with <code>resale</code> sf dataframe. The below code chunk uses <code>st_drop_geometry()</code> and <code>left_join()</code> to perform these operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove geometry</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>buffer_350m_nogeo <span class="ot">=</span> <span class="fu">st_drop_geometry</span>(buffer_350m)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform left_join</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">=</span> resale <span class="sc">|&gt;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(buffer_350m_nogeo, <span class="at">by =</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The same steps are performed to join <code>resale</code> with <code>buffer_1km_nogeo</code> to bring in the count of primary schools within 1 kilometer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove geometry</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>buffer_1km_nogeo <span class="ot">=</span> <span class="fu">st_drop_geometry</span>(buffer_1km)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform left_join</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">=</span> resale <span class="sc">|&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(buffer_1km_nogeo, <span class="at">by =</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="compute-correlation-matrix" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Compute Correlation Matrix</h1>
<p>Before loading the predictors into a predictive model, It is a good practice to use correlation matrix to examine if there is sign of multicollinearity</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>resale_nogeo <span class="ot">&lt;-</span> resale <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"address"</span>,<span class="st">"month"</span>,<span class="st">"resale_price"</span>))</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(resale_nogeo), </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">diag =</span> <span class="cn">FALSE</span>, </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="st">"AOE"</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.pos =</span> <span class="st">"td"</span>, </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"number"</span>, </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"upper"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The correlation matrix shows that <code>unit_age</code> and <code>remaining_lease_yrs</code> have perfect correlation, hence we will exclude <code>unit_age</code>. <code>flat_modelModel.A</code> also has quite strong correlation with <code>remaining_lease_yrs</code> , but the value is below 0.8, so we still use both of these variables when calibrating the predictive models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">=</span> resale <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"unit_age"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="derive-train-and-test-dataset." class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Derive train and test dataset.</h1>
<section id="check-for-overlapping-points" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="check-for-overlapping-points"><span class="header-section-number">6.1</span> Check for Overlapping Points</h2>
<p>When using the GWmodel package to calibrate explanatory or predictive models, it is essential to ensure there are no overlapping point features. The code chunk below checks if there is any overlapping points presented in the <code>resale</code> sf dataframe that we used to split into <code>train_data</code> and <code>test_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>overlapping_points <span class="ot">&lt;-</span> resale <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">overlap =</span> <span class="fu">lengths</span>(<span class="fu">st_equals</span>(., .)) <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(overlapping_points<span class="sc">$</span>overlap <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7706</code></pre>
</div>
</div>
<p>The output shows there are 7,706 overlapping points. This is expected to happen as flats in the same block will have the same postal code, which indicate same address and coordinates.</p>
<p>We use <code>st_jitter()</code> of <strong>sf</strong> package to move the point features by 5 meters to avoid overlapping cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">=</span> resale <span class="sc">|&gt;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_jitter</span>(<span class="at">amount =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk creates training dataset using <code>filter()</code> to filter for transactions in 2023 only. The output is saved in <code>train_data</code> sf dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">=</span> resale <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2023-01"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2023-12"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"address"</span>,<span class="st">"month"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we create testing dataset using <code>filter()</code> to filter for transactions from July 2024 to September 2024. The output is saved in <code>test_data</code> sf dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">=</span> resale <span class="sc">|&gt;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2024-07"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2024-09"</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"address"</span>,<span class="st">"month"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk write the outputs to rds file for future usage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(train_data, <span class="st">"data/rds/train_data.rds"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(test_data, <span class="st">"data/rds/test_data.rds"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale, <span class="st">"data/rds/resale_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk reads the output from rds file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/train_data.rds"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/test_data.rds"</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/resale_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="non-spatial-multiple-linear-regression" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Non-spatial Multiple Linear Regression</h1>
<p>The below code chunk uses <code>lm()</code> function to calibrate a conventional multiple linear regression with <code>resale_price</code> as the dependent variable. Then <code>ols_regress()</code> from <strong>olsrr</strong> package is used to return the model result in high quality summary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>price_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_yrs <span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKETS <span class="sc">+</span> PROX_TOP_SCHOOL <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                  PROX_CLINIC <span class="sc">+</span> kindergarten_count <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>                  childcare_count <span class="sc">+</span> bus_stop_count <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>                  pri_school_count <span class="sc">+</span> flat_modelDBSS <span class="sc">+</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>                  flat_modelImproved <span class="sc">+</span> flat_modelModel.A <span class="sc">+</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>                  flat_modelNew.Generation <span class="sc">+</span> flat_modelPremium.Apartment <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>                  flat_modelSimplified <span class="sc">+</span> flat_modelStandard,</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>train_data)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(price_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.889       RMSE                    40486.104 
R-Squared                   0.790       MSE                1645338285.651 
Adj. R-Squared              0.789       Coef. Var                   9.848 
Pred R-Squared              0.788       AIC                    152921.465 
MAE                     30165.637       SBC                    153090.390 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                     ANOVA                                      
-------------------------------------------------------------------------------
                    Sum of                                                     
                   Squares          DF       Mean Square       F          Sig. 
-------------------------------------------------------------------------------
Regression    3.918497e+13          23      1.703695e+12    1035.468    0.0000 
Residual      1.041664e+13        6331    1645338285.651                       
Total         4.960161e+13        6354                                         
-------------------------------------------------------------------------------

                                                  Parameter Estimates                                                    
------------------------------------------------------------------------------------------------------------------------
                      model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper 
------------------------------------------------------------------------------------------------------------------------
                (Intercept)     378947.733     21367.060                  17.735    0.000     337061.058     420834.409 
             floor_area_sqm       4349.411       117.348        0.279     37.064    0.000       4119.369       4579.452 
               storey_order       3619.876       103.419        0.224     35.002    0.000       3417.141       3822.612 
        remaining_lease_yrs       3567.945        63.180        0.676     56.472    0.000       3444.091       3691.800 
                   PROX_CBD      -8552.639       164.976       -0.432    -51.842    0.000      -8876.047      -8229.231 
             PROX_ELDERCARE      -4310.637      1057.455       -0.027     -4.076    0.000      -6383.606      -2237.668 
                PROX_HAWKER     -11054.238      1473.057       -0.052     -7.504    0.000     -13941.928      -8166.549 
                   PROX_MRT     -35739.721      1673.780       -0.137    -21.353    0.000     -39020.897     -32458.545 
                  PROX_PARK     -12773.720      1591.309       -0.053     -8.027    0.000     -15893.224      -9654.216 
                  PROX_MALL     -14322.814      1568.783       -0.059     -9.130    0.000     -17398.159     -11247.468 
          PROX_SUPERMARKETS       8668.112      3290.294        0.019      2.634    0.008       2218.020      15118.204 
            PROX_TOP_SCHOOL        220.426       429.132        0.003      0.514    0.608       -620.819       1061.670 
                PROX_CLINIC      53507.363      4851.012        0.076     11.030    0.000      43997.737      63016.990 
         kindergarten_count       8314.813       689.591        0.084     12.058    0.000       6962.982       9666.645 
            childcare_count      -2446.759       314.409       -0.055     -7.782    0.000      -3063.107      -1830.411 
             bus_stop_count        662.993       210.434        0.020      3.151    0.002        250.471       1075.514 
           pri_school_count      -1031.911       430.528       -0.017     -2.397    0.017      -1875.892       -187.930 
             flat_modelDBSS    -317211.228     17149.803       -0.333    -18.496    0.000    -350830.650    -283591.805 
         flat_modelImproved    -412220.945     16324.320       -1.950    -25.252    0.000    -444222.141    -380219.748 
          flat_modelModel.A    -388141.852     16085.363       -2.093    -24.130    0.000    -419674.612    -356609.091 
   flat_modelNew.Generation    -395584.837     16136.064       -2.051    -24.516    0.000    -427216.989    -363952.684 
flat_modelPremium.Apartment    -382141.147     16481.762       -0.669    -23.186    0.000    -414450.984    -349831.309 
       flat_modelSimplified    -365627.942     16509.370       -0.827    -22.147    0.000    -397991.901    -333263.983 
         flat_modelStandard    -417547.617     16665.504       -1.040    -25.055    0.000    -450217.650    -384877.584 
------------------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>Taking a significance level of 0.05, the model output shows that <code>PROX_TOP_SCHOOL</code> is not statistically significant (p-value = 0.608). We remove this variable and calibrate the model again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>price_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_yrs <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKETS <span class="sc">+</span> </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                  PROX_CLINIC <span class="sc">+</span> kindergarten_count <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                  childcare_count <span class="sc">+</span> bus_stop_count <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>                  pri_school_count <span class="sc">+</span> flat_modelDBSS <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>                  flat_modelImproved <span class="sc">+</span> flat_modelModel.A <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>                  flat_modelNew.Generation <span class="sc">+</span> flat_modelPremium.Apartment <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>                  flat_modelSimplified <span class="sc">+</span> flat_modelStandard,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>train_data)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(price_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.889       RMSE                    40486.947 
R-Squared                   0.790       MSE                1645146998.541 
Adj. R-Squared              0.789       Coef. Var                   9.848 
Pred R-Squared              0.788       AIC                    152919.729 
MAE                     30159.974       SBC                    153081.897 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                     ANOVA                                      
-------------------------------------------------------------------------------
                    Sum of                                                     
                   Squares          DF       Mean Square       F          Sig. 
-------------------------------------------------------------------------------
Regression    3.918454e+13          22      1.781115e+12    1082.648    0.0000 
Residual      1.041707e+13        6332    1645146998.541                       
Total         4.960161e+13        6354                                         
-------------------------------------------------------------------------------

                                                  Parameter Estimates                                                    
------------------------------------------------------------------------------------------------------------------------
                      model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper 
------------------------------------------------------------------------------------------------------------------------
                (Intercept)     379244.985     21357.980                  17.757    0.000     337376.110     421113.860 
             floor_area_sqm       4349.027       117.339        0.279     37.064    0.000       4119.004       4579.051 
               storey_order       3620.139       103.411        0.224     35.007    0.000       3417.418       3822.860 
        remaining_lease_yrs       3570.120        63.035        0.676     56.637    0.000       3446.551       3693.689 
                   PROX_CBD      -8541.687       163.582       -0.432    -52.216    0.000      -8862.364      -8221.010 
             PROX_ELDERCARE      -4335.074      1056.323       -0.027     -4.104    0.000      -6405.824      -2264.324 
                PROX_HAWKER     -11107.183      1469.360       -0.052     -7.559    0.000     -13987.628      -8226.739 
                   PROX_MRT     -35761.228      1673.159       -0.138    -21.373    0.000     -39041.186     -32481.269 
                  PROX_PARK     -12805.785      1589.991       -0.053     -8.054    0.000     -15922.706      -9688.864 
                  PROX_MALL     -14308.595      1568.447       -0.059     -9.123    0.000     -17383.282     -11233.907 
          PROX_SUPERMARKETS       8946.848      3245.049        0.020      2.757    0.006       2585.453      15308.243 
                PROX_CLINIC      53354.486      4841.592        0.076     11.020    0.000      43863.326      62845.646 
         kindergarten_count       8309.086       689.461        0.084     12.052    0.000       6957.510       9660.663 
            childcare_count      -2449.677       314.339       -0.055     -7.793    0.000      -3065.888      -1833.465 
             bus_stop_count        672.222       209.653        0.020      3.206    0.001        261.231       1083.213 
           pri_school_count      -1087.880       416.487       -0.018     -2.612    0.009      -1904.335       -271.425 
             flat_modelDBSS    -317473.800     17141.186       -0.333    -18.521    0.000    -351076.330    -283871.270 
         flat_modelImproved    -412262.566     16323.170       -1.950    -25.256    0.000    -444261.507    -380263.625 
          flat_modelModel.A    -388207.142     16083.926       -2.093    -24.136    0.000    -419737.084    -356677.199 
   flat_modelNew.Generation    -395683.854     16133.975       -2.051    -24.525    0.000    -427311.910    -364055.799 
flat_modelPremium.Apartment    -382073.977     16480.285       -0.669    -23.184    0.000    -414380.918    -349767.036 
       flat_modelSimplified    -365721.163     16507.413       -0.828    -22.155    0.000    -398081.284    -333361.042 
         flat_modelStandard    -417539.816     16664.528       -1.040    -25.056    0.000    -450207.936    -384871.697 
------------------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>All the parameters have sifnigicant p-values now.</p>
<section id="multicollinearity-check-with-vif" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="multicollinearity-check-with-vif"><span class="header-section-number">7.1</span> Multicollinearity check with VIF</h2>
<p>We move on to examining the variance inflation factors of the independent variables using the <code>check_collinearity()</code> function of <strong>performance</strong> package as in below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>vif <span class="ot">&lt;-</span> performance<span class="sc">::</span><span class="fu">check_collinearity</span>(price_mlr)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>kableExtra<span class="sc">::</span><span class="fu">kable</span>(vif, </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Variance Inflation Factor (VIF) Results"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">18</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Variance Inflation Factor (VIF) Results</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIF_CI_low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIF_CI_high</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE_factor</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance_CI_low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tolerance_CI_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">floor_area_sqm</td>
<td style="text-align: right;">1.707226</td>
<td style="text-align: right;">1.650506</td>
<td style="text-align: right;">1.768892</td>
<td style="text-align: right;">1.306609</td>
<td style="text-align: right;">0.5857455</td>
<td style="text-align: right;">0.5653257</td>
<td style="text-align: right;">0.6058748</td>
</tr>
<tr class="even">
<td style="text-align: left;">storey_order</td>
<td style="text-align: right;">1.235415</td>
<td style="text-align: right;">1.202017</td>
<td style="text-align: right;">1.274333</td>
<td style="text-align: right;">1.111492</td>
<td style="text-align: right;">0.8094449</td>
<td style="text-align: right;">0.7847244</td>
<td style="text-align: right;">0.8319347</td>
</tr>
<tr class="odd">
<td style="text-align: left;">remaining_lease_yrs</td>
<td style="text-align: right;">4.298088</td>
<td style="text-align: right;">4.117224</td>
<td style="text-align: right;">4.489445</td>
<td style="text-align: right;">2.073183</td>
<td style="text-align: right;">0.2326616</td>
<td style="text-align: right;">0.2227447</td>
<td style="text-align: right;">0.2428821</td>
</tr>
<tr class="even">
<td style="text-align: left;">PROX_CBD</td>
<td style="text-align: right;">2.059046</td>
<td style="text-align: right;">1.985379</td>
<td style="text-align: right;">2.138220</td>
<td style="text-align: right;">1.434938</td>
<td style="text-align: right;">0.4856618</td>
<td style="text-align: right;">0.4676787</td>
<td style="text-align: right;">0.5036821</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PROX_ELDERCARE</td>
<td style="text-align: right;">1.303931</td>
<td style="text-align: right;">1.267001</td>
<td style="text-align: right;">1.345967</td>
<td style="text-align: right;">1.141898</td>
<td style="text-align: right;">0.7669121</td>
<td style="text-align: right;">0.7429603</td>
<td style="text-align: right;">0.7892650</td>
</tr>
<tr class="even">
<td style="text-align: left;">PROX_HAWKER</td>
<td style="text-align: right;">1.442244</td>
<td style="text-align: right;">1.398424</td>
<td style="text-align: right;">1.490884</td>
<td style="text-align: right;">1.200935</td>
<td style="text-align: right;">0.6933639</td>
<td style="text-align: right;">0.6707429</td>
<td style="text-align: right;">0.7150908</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PROX_MRT</td>
<td style="text-align: right;">1.247992</td>
<td style="text-align: right;">1.213937</td>
<td style="text-align: right;">1.287469</td>
<td style="text-align: right;">1.117136</td>
<td style="text-align: right;">0.8012870</td>
<td style="text-align: right;">0.7767176</td>
<td style="text-align: right;">0.8237663</td>
</tr>
<tr class="even">
<td style="text-align: left;">PROX_PARK</td>
<td style="text-align: right;">1.322621</td>
<td style="text-align: right;">1.284747</td>
<td style="text-align: right;">1.365532</td>
<td style="text-align: right;">1.150052</td>
<td style="text-align: right;">0.7560747</td>
<td style="text-align: right;">0.7323153</td>
<td style="text-align: right;">0.7783635</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PROX_MALL</td>
<td style="text-align: right;">1.256523</td>
<td style="text-align: right;">1.222024</td>
<td style="text-align: right;">1.296383</td>
<td style="text-align: right;">1.120947</td>
<td style="text-align: right;">0.7958469</td>
<td style="text-align: right;">0.7713769</td>
<td style="text-align: right;">0.8183147</td>
</tr>
<tr class="even">
<td style="text-align: left;">PROX_SUPERMARKETS</td>
<td style="text-align: right;">1.525103</td>
<td style="text-align: right;">1.477224</td>
<td style="text-align: right;">1.577786</td>
<td style="text-align: right;">1.234951</td>
<td style="text-align: right;">0.6556934</td>
<td style="text-align: right;">0.6337996</td>
<td style="text-align: right;">0.6769455</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PROX_CLINIC</td>
<td style="text-align: right;">1.419602</td>
<td style="text-align: right;">1.376897</td>
<td style="text-align: right;">1.467145</td>
<td style="text-align: right;">1.191471</td>
<td style="text-align: right;">0.7044228</td>
<td style="text-align: right;">0.6815958</td>
<td style="text-align: right;">0.7262706</td>
</tr>
<tr class="even">
<td style="text-align: left;">kindergarten_count</td>
<td style="text-align: right;">1.450042</td>
<td style="text-align: right;">1.405838</td>
<td style="text-align: right;">1.499061</td>
<td style="text-align: right;">1.204177</td>
<td style="text-align: right;">0.6896351</td>
<td style="text-align: right;">0.6670843</td>
<td style="text-align: right;">0.7113193</td>
</tr>
<tr class="odd">
<td style="text-align: left;">childcare_count</td>
<td style="text-align: right;">1.509137</td>
<td style="text-align: right;">1.462037</td>
<td style="text-align: right;">1.561038</td>
<td style="text-align: right;">1.228469</td>
<td style="text-align: right;">0.6626304</td>
<td style="text-align: right;">0.6405996</td>
<td style="text-align: right;">0.6839771</td>
</tr>
<tr class="even">
<td style="text-align: left;">bus_stop_count</td>
<td style="text-align: right;">1.182918</td>
<td style="text-align: right;">1.152352</td>
<td style="text-align: right;">1.219617</td>
<td style="text-align: right;">1.087621</td>
<td style="text-align: right;">0.8453668</td>
<td style="text-align: right;">0.8199293</td>
<td style="text-align: right;">0.8677903</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pri_school_count</td>
<td style="text-align: right;">1.356158</td>
<td style="text-align: right;">1.316602</td>
<td style="text-align: right;">1.400657</td>
<td style="text-align: right;">1.164542</td>
<td style="text-align: right;">0.7373771</td>
<td style="text-align: right;">0.7139509</td>
<td style="text-align: right;">0.7595310</td>
</tr>
<tr class="even">
<td style="text-align: left;">flat_modelDBSS</td>
<td style="text-align: right;">9.737887</td>
<td style="text-align: right;">9.296974</td>
<td style="text-align: right;">10.202230</td>
<td style="text-align: right;">3.120559</td>
<td style="text-align: right;">0.1026917</td>
<td style="text-align: right;">0.0980178</td>
<td style="text-align: right;">0.1075619</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flat_modelImproved</td>
<td style="text-align: right;">179.753156</td>
<td style="text-align: right;">171.186319</td>
<td style="text-align: right;">188.751231</td>
<td style="text-align: right;">13.407205</td>
<td style="text-align: right;">0.0055632</td>
<td style="text-align: right;">0.0052980</td>
<td style="text-align: right;">0.0058416</td>
</tr>
<tr class="even">
<td style="text-align: left;">flat_modelModel.A</td>
<td style="text-align: right;">226.806430</td>
<td style="text-align: right;">215.990677</td>
<td style="text-align: right;">238.166301</td>
<td style="text-align: right;">15.060094</td>
<td style="text-align: right;">0.0044090</td>
<td style="text-align: right;">0.0041987</td>
<td style="text-align: right;">0.0046298</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flat_modelNew.Generation</td>
<td style="text-align: right;">210.875295</td>
<td style="text-align: right;">200.820973</td>
<td style="text-align: right;">221.435517</td>
<td style="text-align: right;">14.521546</td>
<td style="text-align: right;">0.0047421</td>
<td style="text-align: right;">0.0045160</td>
<td style="text-align: right;">0.0049796</td>
</tr>
<tr class="even">
<td style="text-align: left;">flat_modelPremium.Apartment</td>
<td style="text-align: right;">25.122070</td>
<td style="text-align: right;">23.945849</td>
<td style="text-align: right;">26.358586</td>
<td style="text-align: right;">5.012192</td>
<td style="text-align: right;">0.0398056</td>
<td style="text-align: right;">0.0379383</td>
<td style="text-align: right;">0.0417609</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flat_modelSimplified</td>
<td style="text-align: right;">42.063068</td>
<td style="text-align: right;">40.077145</td>
<td style="text-align: right;">44.149917</td>
<td style="text-align: right;">6.485605</td>
<td style="text-align: right;">0.0237738</td>
<td style="text-align: right;">0.0226501</td>
<td style="text-align: right;">0.0249519</td>
</tr>
<tr class="even">
<td style="text-align: left;">flat_modelStandard</td>
<td style="text-align: right;">51.903915</td>
<td style="text-align: right;">49.447646</td>
<td style="text-align: right;">54.484714</td>
<td style="text-align: right;">7.204437</td>
<td style="text-align: right;">0.0192664</td>
<td style="text-align: right;">0.0183538</td>
<td style="text-align: right;">0.0202234</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="calibrate-final-model" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="calibrate-final-model"><span class="header-section-number">7.2</span> Calibrate final model</h2>
<p>As all the flat_model dummy columns have VIF &gt; 10 except for DBSS model. We exclude all of these columns except for <code>flat_modelDBSS</code> and run the linear regression model again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>price_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_yrs <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKETS <span class="sc">+</span> </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                  PROX_CLINIC <span class="sc">+</span> kindergarten_count <span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>                  childcare_count <span class="sc">+</span> bus_stop_count <span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                  pri_school_count <span class="sc">+</span> flat_modelDBSS,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>train_data)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(price_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.872       RMSE                    43167.880 
R-Squared                   0.761       MSE                1868464078.877 
Adj. R-Squared              0.761       Coef. Var                  10.495 
Pred R-Squared              0.759       AIC                    153722.657 
MAE                     31730.772       SBC                    153844.283 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                     ANOVA                                      
-------------------------------------------------------------------------------
                    Sum of                                                     
                   Squares          DF       Mean Square       F          Sig. 
-------------------------------------------------------------------------------
Regression    3.775929e+13          16      2.359955e+12    1263.046    0.0000 
Residual      1.184233e+13        6338    1868464078.877                       
Total         4.960161e+13        6354                                         
-------------------------------------------------------------------------------

                                              Parameter Estimates                                                
----------------------------------------------------------------------------------------------------------------
              model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper 
----------------------------------------------------------------------------------------------------------------
        (Intercept)    -121041.257      7409.850                 -16.335    0.000    -135567.070    -106515.444 
     floor_area_sqm       5437.384        97.777        0.349     55.610    0.000       5245.708       5629.060 
       storey_order       3449.951       109.341        0.214     31.552    0.000       3235.606       3664.297 
remaining_lease_yrs       3922.757        42.365        0.743     92.594    0.000       3839.707       4005.807 
           PROX_CBD      -8488.633       168.762       -0.429    -50.299    0.000      -8819.464      -8157.802 
     PROX_ELDERCARE      -2750.815      1108.676       -0.017     -2.481    0.013      -4924.196       -577.435 
        PROX_HAWKER      -6236.707      1526.420       -0.029     -4.086    0.000      -9229.007      -3244.407 
           PROX_MRT     -35599.234      1759.413       -0.137    -20.234    0.000     -39048.279     -32150.188 
          PROX_PARK     -13741.182      1660.426       -0.057     -8.276    0.000     -16996.178     -10486.186 
          PROX_MALL     -12048.548      1661.539       -0.050     -7.251    0.000     -15305.727      -8791.369 
  PROX_SUPERMARKETS       6753.333      3441.431        0.015      1.962    0.050          6.963      13499.702 
        PROX_CLINIC      52619.006      5114.583        0.075     10.288    0.000      42592.693      62645.319 
 kindergarten_count       8072.823       732.305        0.081     11.024    0.000       6637.257       9508.388 
    childcare_count      -2409.540       334.087       -0.054     -7.212    0.000      -3064.463      -1754.616 
     bus_stop_count        930.380       221.226        0.028      4.206    0.000        496.703       1364.057 
   pri_school_count       -408.141       437.272       -0.007     -0.933    0.351      -1265.343        449.060 
     flat_modelDBSS      73540.327      5973.472        0.077     12.311    0.000      61830.301      85250.353 
----------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>The result shows that <code>pri_school_count</code> has insignificant p-value of 0.351. We exclude this variable from the predictors and calibrate the model again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>price_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_yrs <span class="sc">+</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKETS <span class="sc">+</span> </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>                  PROX_CLINIC <span class="sc">+</span> kindergarten_count <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                  childcare_count <span class="sc">+</span> bus_stop_count <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>                  flat_modelDBSS,</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>train_data)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(price_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.872       RMSE                    43170.846 
R-Squared                   0.761       MSE                1868426113.617 
Adj. R-Squared              0.761       Coef. Var                  10.495 
Pred R-Squared              0.759       AIC                    153721.531 
MAE                     31715.584       SBC                    153836.400 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                     ANOVA                                      
-------------------------------------------------------------------------------
                    Sum of                                                     
                   Squares          DF       Mean Square       F          Sig. 
-------------------------------------------------------------------------------
Regression    3.775766e+13          15      2.517177e+12    1347.218    0.0000 
Residual      1.184395e+13        6339    1868426113.617                       
Total         4.960161e+13        6354                                         
-------------------------------------------------------------------------------

                                              Parameter Estimates                                                
----------------------------------------------------------------------------------------------------------------
              model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper 
----------------------------------------------------------------------------------------------------------------
        (Intercept)    -121560.205      7388.887                 -16.452    0.000    -136044.922    -107075.488 
     floor_area_sqm       5432.111        97.613        0.348     55.650    0.000       5240.757       5623.464 
       storey_order       3454.012       109.253        0.214     31.615    0.000       3239.839       3668.186 
remaining_lease_yrs       3923.891        42.347        0.743     92.660    0.000       3840.877       4006.906 
           PROX_CBD      -8532.163       162.189       -0.431    -52.606    0.000      -8850.107      -8214.218 
     PROX_ELDERCARE      -2571.665      1091.924       -0.016     -2.355    0.019      -4712.206       -431.124 
        PROX_HAWKER      -6336.132      1522.683       -0.030     -4.161    0.000      -9321.106      -3351.157 
           PROX_MRT     -35287.557      1727.417       -0.136    -20.428    0.000     -38673.880     -31901.235 
          PROX_PARK     -13907.886      1650.775       -0.058     -8.425    0.000     -17143.964     -10671.808 
          PROX_MALL     -11929.625      1656.630       -0.049     -7.201    0.000     -15177.181      -8682.070 
  PROX_SUPERMARKETS       7107.188      3420.451        0.016      2.078    0.038        401.948      13812.429 
        PROX_CLINIC      52372.010      5107.681        0.074     10.254    0.000      42359.228      62384.792 
 kindergarten_count       8071.060       732.295        0.081     11.022    0.000       6635.514       9506.606 
    childcare_count      -2443.520       332.094       -0.055     -7.358    0.000      -3094.537      -1792.503 
     bus_stop_count        931.647       221.219        0.028      4.211    0.000        497.982       1365.312 
     flat_modelDBSS      73453.453      5972.686        0.077     12.298    0.000      61744.967      85161.938 
----------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>Now all the parameters are statistically significant. Key observations of the model output are as following:</p>
<ul>
<li><p><strong>Positive Predictors</strong>:</p>
<ul>
<li><p><code>floor_area_sqm</code>, <code>storey_order</code>, and <code>remaining_lease_yrs</code> have positive coefficients, indicating that resale prices are likely to increase with larger floor area, higher floors, and longer remaining lease periods.</p></li>
<li><p>Certain amenities proximity, such as <code>PROX_SUPERMARKETS</code>, <code>PROX_CLINIC</code>, and the counts of kindergartens and bus stops also show a positive influence on price.</p></li>
</ul></li>
<li><p><strong>Negative Predictors</strong>:</p>
<ul>
<li>Interestingly, amenities proximity such as <code>PROX_CBD</code>, <code>PROX_ELDERCARE</code>, <code>PROX_HAWKER</code>, <code>PROX_MRT</code>, <code>PROX_PARK</code>, and <code>PROX_MALL</code> and higher <code>childcare_count</code> shows a negative coefficient. This suggests that being closer to these amenities may be associated with lower resale prices.</li>
</ul></li>
</ul>
<p>We write the model result to rds file for future use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(price_mlr, <span class="st">"data/rds/price_mlr.rds"</span> ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we calculate the accuracy on <code>test_data</code> using below code chunk with the following functions:</p>
<ul>
<li><p><code>predict()</code>: use <code>price_mlr</code> model to predict <code>resale_price</code> on <code>test_data</code>. The result is saved in column <code>lm_resale_price</code> in <code>test_data</code> sf dataframe.</p></li>
<li><p><code>mae()</code>: function from Metrics package to calculate the mean absolute error given the actual and predicted values.</p></li>
<li><p><code>rmse()</code>: function from Metrics package to calculate the root mean square error given the actual and predicted values.</p></li>
<li><p><code>cat()</code>: concatenate the text strings and print the result.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on test data</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>lm_resale_price <span class="ot">&lt;-</span> <span class="fu">predict</span>(price_mlr, <span class="at">newdata =</span> test_data)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate RMSE and MAE</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>lm_rmse <span class="ot">=</span> <span class="fu">rmse</span>(test_data<span class="sc">$</span>resale_price, test_data<span class="sc">$</span>lm_resale_price)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>lm_mae <span class="ot">=</span> <span class="fu">mae</span>(test_data<span class="sc">$</span>resale_price, test_data<span class="sc">$</span>lm_resale_price)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display accuracy metrics</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean Absolute Error (MAE):"</span>, lm_mae, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Absolute Error (MAE): 45175.31 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Root Mean Squared Error (RMSE):"</span>, lm_rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error (RMSE): 60416.34 </code></pre>
</div>
</div>
<p>The MAE is 45175.31 and RMSE is 60416.34 when using <code>price_mlr</code> linear regression model to predict <code>resale_price</code> on <code>test_data</code>, without taking into account geospatial location of the HDB block.</p>
</section>
</section>
<section id="non-spatial-random-forest" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Non-spatial Random Forest</h1>
<section id="prepare-coordinates-data" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="prepare-coordinates-data"><span class="header-section-number">8.1</span> Prepare Coordinates data</h2>
<p>The code chunk below extracts the x,y coordinates of the full, training and testing data sets. The result are saved in <code>coords_hdb</code>, <code>coords_train</code> and <code>coords_test</code> respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>coords_hdb <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(resale)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(train_data)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We write all the output into rds file for future use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(coords_hdb, <span class="st">"data/rds/coords_hdb.rds"</span> )</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(coords_train, <span class="st">"data/rds/coords_train.rds"</span> )</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(coords_test, <span class="st">"data/rds/coords_test.rds"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As random forest modelling function require aspatial dataframe, we drop the geometry from the train and test dataset using <code>st_drop_geometry()</code>. The output is saved in <code>train_data_nogeo</code> and <code>test_data_nogeo</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>train_data_nogeo <span class="ot">=</span> train_data <span class="sc">|&gt;</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>test_data_nogeo <span class="ot">=</span> test_data <span class="sc">|&gt;</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calibrate-random-forest-model" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="calibrate-random-forest-model"><span class="header-section-number">8.2</span> Calibrate Random Forest Model</h2>
<p>In this section, we explore how to calibrate a model to predict HDB resale price using random forest function of <strong>ranger</strong> package.</p>
<p>Before running the model, we set the seed using <code>set.seed()</code> to ensure the model result is reproducible. Next we use <code>ranger()</code> function to calibrate the random forest model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_yrs <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKETS <span class="sc">+</span> PROX_TOP_SCHOOL <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>                  PROX_CLINIC <span class="sc">+</span> kindergarten_count <span class="sc">+</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>                  childcare_count <span class="sc">+</span> bus_stop_count <span class="sc">+</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>                  pri_school_count <span class="sc">+</span> flat_modelDBSS <span class="sc">+</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>                  flat_modelImproved <span class="sc">+</span> flat_modelModel.A <span class="sc">+</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>                  flat_modelNew.Generation <span class="sc">+</span> flat_modelPremium.Apartment <span class="sc">+</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                  flat_modelSimplified <span class="sc">+</span> flat_modelStandard,</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>train_data_nogeo)</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger(resale_price ~ floor_area_sqm + storey_order + remaining_lease_yrs +      PROX_CBD + PROX_ELDERCARE + PROX_HAWKER + PROX_MRT + PROX_PARK +      PROX_MALL + PROX_SUPERMARKETS + PROX_TOP_SCHOOL + PROX_CLINIC +      kindergarten_count + childcare_count + bus_stop_count + pri_school_count +      flat_modelDBSS + flat_modelImproved + flat_modelModel.A +      flat_modelNew.Generation + flat_modelPremium.Apartment +      flat_modelSimplified + flat_modelStandard, data = train_data_nogeo) 

Type:                             Regression 
Number of trees:                  500 
Sample size:                      6355 
Number of independent variables:  23 
Mtry:                             4 
Target node size:                 5 
Variable importance mode:         none 
Splitrule:                        variance 
OOB prediction error (MSE):       596759960 
R squared (OOB):                  0.9235546 </code></pre>
</div>
</div>
<p>The model use the defaul number of trees of 500 to derive the forest using <code>train_data_nogeo</code>. We write the output to rds file using the below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(rf, <span class="st">"data/rds/rf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we calculate the accuracy on <code>test_data_nogeo</code> using below code chunk with the following functions:</p>
<ul>
<li><p><code>predict()</code>: use <code>rf</code> model to predict <code>resale_price</code> on <code>test_data_nogeo</code>. The result is saved in column <code>rf_resale_price</code> in <code>test_data_nogeo</code> dataframe.</p></li>
<li><p><code>mae()</code>: function from Metrics package to calculate the mean absolute error given the actual and predicted values.</p></li>
<li><p><code>rmse()</code>: function from Metrics package to calculate the root mean square error given the actual and predicted values.</p></li>
<li><p><code>cat()</code>: concatenate the text strings and print the result.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on test_data</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>test_data_nogeo<span class="sc">$</span>rf_resale_price <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf, <span class="at">data =</span> test_data_nogeo)<span class="sc">$</span>predictions</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate RMSE and MAE</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>rf_rmse <span class="ot">=</span> <span class="fu">rmse</span>(test_data_nogeo<span class="sc">$</span>resale_price,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>               test_data_nogeo<span class="sc">$</span>rf_resale_price)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>rf_mae <span class="ot">=</span> <span class="fu">mae</span>(test_data_nogeo<span class="sc">$</span>resale_price, </span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>             test_data_nogeo<span class="sc">$</span>rf_resale_price)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display accuracy metrics</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean Absolute Error (MAE):"</span>, rf_mae, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Absolute Error (MAE): 36615.87 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Root Mean Squared Error (RMSE):"</span>, rf_rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error (RMSE): 49840.55 </code></pre>
</div>
</div>
<p>The non-spatial Random Forest model have a lower MAE and RMSE than the previous multiple linear regression model, which indicate this random forest model performs better at predicting <code>resale_price</code> given the same set of predictors.</p>
</section>
</section>
<section id="geographically-weighted-random-forest-gwrf" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Geographically Weighted Random Forest (GWRF)</h1>
<p>In this section, we explore how to calibrate a model to predict HDB resale price using <code>grf()</code> function of <strong>SpatialML</strong> package.</p>
<p>Key arguments used in below function:</p>
<ul>
<li><p><code>formula</code>: indicate the model dependent and independent variables</p></li>
<li><p><code>dframe</code>: a non-spatial data frame of the data to be used for training</p></li>
<li><p><code>bw</code>: the number of nearest neighbors to be considered</p></li>
<li><p><code>kernel</code>: use <code>adaptive</code> kernel</p></li>
<li><p><code>coords</code>: load in the respective X and Y coordinates from <code>coords_train</code></p></li>
<li><p><code>ntree</code>: number of trees to grow for each local forest, we use 500 trees as default.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">grf</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> floor_area_sqm <span class="sc">+</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                  storey_order <span class="sc">+</span> remaining_lease_yrs <span class="sc">+</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                  PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>                  PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span> PROX_MALL <span class="sc">+</span> </span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>                  PROX_SUPERMARKETS <span class="sc">+</span> PROX_TOP_SCHOOL <span class="sc">+</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>                  PROX_CLINIC <span class="sc">+</span> kindergarten_count <span class="sc">+</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>                  childcare_count <span class="sc">+</span> bus_stop_count <span class="sc">+</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>                  pri_school_count <span class="sc">+</span> flat_modelDBSS <span class="sc">+</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>                  flat_modelImproved <span class="sc">+</span> flat_modelModel.A <span class="sc">+</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>                  flat_modelNew.Generation <span class="sc">+</span> flat_modelPremium.Apartment <span class="sc">+</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>                  flat_modelSimplified <span class="sc">+</span> flat_modelStandard,</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dframe=</span>train_data_nogeo, </span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bw=</span><span class="dv">55</span>,</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kernel=</span><span class="st">"adaptive"</span>,</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords=</span>coords_train,</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ntree=</span><span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model output is saved into rds format using the below code chunk for future use and avoid having to run the model again, as calibrating GWRF takes long time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_adaptive, <span class="st">"data/rds/gwRF_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk retrieves the saved model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/gwRF_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="predict-using-test-data" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="predict-using-test-data"><span class="header-section-number">9.1</span> Predict using test data</h2>
<p>The code chunk below combines the test data with its corresponding coordinates data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>test_data_nogeom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  test_data_nogeo, coords_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, <code>predict.grf()</code> of <strong>spatialML</strong> package is used to predict the resale price using the test data and gwRF_adaptive model calibrated earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>gwRF_pred <span class="ot">&lt;-</span> <span class="fu">predict.grf</span>(gwRF_adaptive, </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                           test_data_nogeom, </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x.var.name=</span><span class="st">"X"</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y.var.name=</span><span class="st">"Y"</span>, </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">local.w=</span><span class="dv">1</span>,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">global.w=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before moving on, we save the output into rds file for future usage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_pred, <span class="st">"data/rds/GRF_pred.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="convert-the-predicting-output-into-a-data-frame" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="convert-the-predicting-output-into-a-data-frame"><span class="header-section-number">9.1.1</span> Convert the predicting output into a data frame</h3>
<p>The output of the <code>predict.grf()</code> is a vector of predicted values. It is more efficient to convert it into a data frame for further visualization and analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>GRF_pred <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/GRF_pred.rds"</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>GRF_pred_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(GRF_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next <code>cbind()</code> is used to append the predicted values onto <code>test_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>test_data_p <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, GRF_pred_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We write the result to rds file format using below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(test_data_p, <span class="st">"data/rds/test_data_p.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk calculates and print out the RMSE and MAE of predicted resale price on test data using the above <code>gwRF_adaptive</code> model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>grf_rmse <span class="ot">=</span> <span class="fu">rmse</span>(test_data_p<span class="sc">$</span>resale_price, test_data_p<span class="sc">$</span>GRF_pred)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>grf_mae <span class="ot">=</span> <span class="fu">mae</span>(test_data_p<span class="sc">$</span>resale_price, test_data_p<span class="sc">$</span>GRF_pred)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Display accuracy metrics</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean Absolute Error (MAE):"</span>, grf_mae, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Absolute Error (MAE): 41845.79 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Root Mean Squared Error (RMSE):"</span>, grf_rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error (RMSE): 70708.71 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="compare-model-performance" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Compare Model Performance</h1>
<section id="rmse-and-mae" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="rmse-and-mae"><span class="header-section-number">10.1</span> RMSE and MAE</h2>
<p>Root Mean Squared Error (RMSE) and Mean Absolute Error (MAE) are commonly used metrics to evaluate and compare model performance on test data. RMSE measures the square root of the average squared differences between predicted and actual values, penalizing larger errors more heavily, while MAE calculates the average absolute differences, providing a more straightforward interpretation of the average error magnitude. When comparing linear regression and random forest models, lower RMSE and MAE values indicate better predictive accuracy. If the random forest model yields lower RMSE and MAE values than linear regression, it suggests that the random forest captures complex, non-linear relationships in the data more effectively. However, if linear regression performs similarly, it may indicate that a simpler, interpretable model is sufficient for the task.</p>
<p>The below code chunk prints out the RMSE and MAE of the 3 predictive models we have calibrated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Non-spatial Linear Regression - MAE:"</span>, lm_mae, <span class="st">"RMSE:"</span>, lm_rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-spatial Linear Regression - MAE: 45175.31 RMSE: 60416.34 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Non-spatial Random Forest - MAE:"</span>, rf_mae, <span class="st">"RMSE:"</span>, rf_rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-spatial Random Forest - MAE: 36615.87 RMSE: 49840.55 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Geographically Weighted Random Forest - MAE:"</span>, grf_mae, <span class="st">"RMSE:"</span>, grf_rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geographically Weighted Random Forest - MAE: 41845.79 RMSE: 70708.71 </code></pre>
</div>
</div>
<p>The output shows that:</p>
<ul>
<li><p>Non-spatial Random Forest has the best performance on <code>test_data</code> with the lowest MAE and RMSE.</p></li>
<li><p>Geographically weighted Random Forest has the second lowest MAE but has the highest RMSE, indicating large errors on certain records.</p></li>
<li><p>Linear Regression has the highest MAE and second highest RMSE, suggesting the relationship between resale price and other predictors are likely non-linear, which is better captured in Random Forest model.</p></li>
<li><p>GWRF’s lower performance compared to non-spatial Random Forest may result from overfitting due to spatial non-stationarity. Calculating an optimal adaptive bandwidth could improve this, though attempts to use the <code>grf.bw()</code> function were unsuccessful, as it is still in development (as stated in <a href="https://cran.r-project.org/web/packages/SpatialML/SpatialML.pdf">SpatialML documents</a>). We can try again when further improvement of this function is included in future version of SpatialML package.</p></li>
</ul>
</section>
<section id="visualize-the-predicted-values" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="visualize-the-predicted-values"><span class="header-section-number">10.2</span> Visualize the Predicted Values</h2>
<p>Using a scatterplot to visualize actual versus predicted resale prices on the test dataset offers a clear, intuitive way to assess model performance. By plotting actual prices on one axis and predicted prices on the other, we can quickly see how well the model aligns with real values. Ideally, the points should fall along a 45-degree line, indicating that predictions closely match actual outcomes. Deviations from this line reveal errors and can highlight patterns, such as systematic under- or over-predictions. Additionally, scatterplots can help identify any potential outliers or segments where the model performs poorly, providing valuable insights for model refinement.</p>
<p>The below code chunk uses <code>ggplot</code> function to create 3 scatterplots on actual resale prices and predicted resale prices of the 3 models derived. The output plot are saved in <code>plot_lm</code>, <code>plot_rf</code> and <code>plot_grf</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression scatter plot</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>plot_lm <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> resale_price,</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> lm_resale_price)) <span class="sc">+</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual Resale Price"</span>, </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Resale Price (Linear Regression)"</span>, </span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"MLR"</span>) <span class="sc">+</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Random forrest scatter plot</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>plot_rf <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_nogeo,</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> resale_price,</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> rf_resale_price)) <span class="sc">+</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual Resale Price"</span>, </span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Resale Price (Random Forest)"</span>, </span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"RF"</span>) <span class="sc">+</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="co"># GWRF scatter plot</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>plot_grf <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> test_data_p,</span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> resale_price,</span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> GRF_pred)) <span class="sc">+</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Actual Resale Price"</span>, </span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Predicted Resale Price (GWRF)"</span>, </span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"GWRF"</span>) <span class="sc">+</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The below code chunk use <code>grid.arrange()</code> function from <strong>gridExtra</strong> package to draw the 3 scatter plots on the same row for easier comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(plot_lm, plot_rf, plot_grf, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The scatter plots of all three models show most points falling below the diagonal, indicating a tendency to underpredict resale prices, especially as prices increase. In the GWRF model, some of the points deviate significantly from the diagonal line, explaining why its RMSE is significantly higher compared to the other models. This supports the earlier observation of potential overfitting in the GWRF model, and calculating the optimal adaptive bandwidth could help improve its performance.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Conclusion</h1>
<p>In summary, the predictive modeling of HDB resale prices using three approaches—Linear Regression, Random Forest, and Geographically Weighted Random Forest (GWRF)—has provided insights into the strengths and limitations of each model. The non-spatial Random Forest model achieved the best performance, with the lowest Mean Absolute Error (MAE) and Root Mean Square Error (RMSE) on the test dataset, indicating its effectiveness in capturing non-linear relationships between resale prices and the predictors. The Linear Regression model had the weakest performance, suggesting that a linear model does not adequately capture the complexity of the factors influencing resale prices. Although the GWRF model achieved a lower MAE than Linear Regression, it had the highest RMSE, showing that it struggles with larger errors on certain records, potentially due to spatial overfitting.</p>
<p>The scatter plots further reinforce these findings, showing a consistent tendency across all models to underpredict higher resale prices. The GWRF model, in particular, exhibited significant deviations from the diagonal line, suggesting potential overfitting to local spatial patterns. This may be attributed to spatial non-stationarity, where the relationship between predictors and resale prices varies across locations. Refining the GWRF model with an optimal adaptive bandwidth could potentially address this issue and improve its accuracy; however, attempts to optimize the bandwidth with the <code>grf.bw()</code> function were unsuccessful, as the function took forever to load and can be due to it is still under development in the SpatialML package.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>